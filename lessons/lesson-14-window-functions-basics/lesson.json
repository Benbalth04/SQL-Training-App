{
    "lesson-id": "lesson-14-window-functions-basics",
    "title": "Lesson 14",
    "subtitle": "Intro to Window Functions",
    "lesson-order": 14,
    "database-tables": [
        {
            "name": "Countries",
            "priority": 1
        }
    ],
    "exercise-tasks": [
        {
            "task-id": 14.1,
            "description": "Compute the running total of the population for all countries ordered by population",
            "correct-query": "SELECT\n  Name,\n  Population,\n  SUM(Population) OVER (ORDER BY Population) AS RunningTotal\nFROM Countries",
            "verify-query": "SELECT Name, Population, SUM(Population) OVER (ORDER BY Population) AS RunningTotal FROM Countries",
            "order-sensitive": false,
            "exercise-order": 1,
            "initial-query": "SELECT * FROM Countries",
            "large-query": false,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": "Explain why this SQL query correctly computes a running total of the population for all countries ordered by population. How does the SUM() OVER (ORDER BY Population) clause work? What is the difference between a window function and a standard aggregate function? Why is the ORDER BY inside OVER important for the running total?\n\nCorrect query:\nSELECT\n  Name,\n  Population,\n  SUM(Population) OVER (ORDER BY Population) AS RunningTotal\nFROM Countries"
        },
        {
            "task-id": 14.2,
            "description": "Calculate the total population per region for each country using a window function",
            "correct-query": "SELECT\n  Name,\n  Region,\n  Population,\n  SUM(Population) OVER (PARTITION BY Region) AS RegionTotal\nFROM Countries",
            "verify-query": "SELECT Name, Region, Population, SUM(Population) OVER (PARTITION BY Region) AS RegionTotal FROM Countries",
            "order-sensitive": false,
            "exercise-order": 2,
            "initial-query": "SELECT * FROM Countries",
            "large-query": false,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": "Explain why this SQL query correctly calculates the total population per region for each country using a window function. How does the PARTITION BY clause affect the calculation? How does SUM() OVER differ from a GROUP BY aggregate? Why does each row still retain the individual country's data while computing the regional total?\n\nCorrect query:\nSELECT\n  Name,\n  Region,\n  Population,\n  SUM(Population) OVER (PARTITION BY Region) AS RegionTotal\nFROM Countries"
        },
        {
            "task-id": 14.3,
            "description": "Find the average population per region for each country",
            "correct-query": "SELECT\n  Name,\n  Region,\n  Population,\n  AVG(Population) OVER (PARTITION BY Region) AS RegionAvg\nFROM Countries",
            "verify-query": "SELECT Name, Region, Population, AVG(Population) OVER (PARTITION BY Region) AS RegionAvg FROM Countries",
            "order-sensitive": false,
            "exercise-order": 3,
            "initial-query": "SELECT * FROM Countries",
            "large-query": false,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": "Explain why this SQL query correctly finds the average population per region for each country using a window function. How does AVG() OVER (PARTITION BY Region) compute the average? How does the window function differ from using GROUP BY with AVG? Why does each row still show the individual country's data along with the region average?\n\nCorrect query:\nSELECT\n  Name,\n  Region,\n  Population,\n  AVG(Population) OVER (PARTITION BY Region) AS RegionAvg\nFROM Countries"
        },
        {
            "task-id": 14.4,
            "description": "Determine, for each country, the maximum population within its region",
            "correct-query": "SELECT\n  Name,\n  Region,\n  Population,\n  MAX(Population) OVER (PARTITION BY Region) AS RegionMax\nFROM Countries",
            "verify-query": "SELECT Name, Region, Population, MAX(Population) OVER (PARTITION BY Region) AS RegionMax FROM Countries",
            "order-sensitive": false,
            "exercise-order": 4,
            "initial-query": "SELECT * FROM Countries",
            "large-query": false,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": "Explain why this SQL query correctly determines, for each country, the maximum population within its region using a window function. How does MAX() OVER (PARTITION BY Region) calculate the maximum? How is this different from using GROUP BY with MAX? Why does each country still appear as a separate row with its own data?\n\nCorrect query:\nSELECT\n  Name,\n  Region,\n  Population,\n  MAX(Population) OVER (PARTITION BY Region) AS RegionMax\nFROM Countries"
        }
    ]
}
