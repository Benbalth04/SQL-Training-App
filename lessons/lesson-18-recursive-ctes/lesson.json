{
    "lesson-id": "lesson-18-recursive-ctes",
    "title": "Lesson 18",
    "subtitle": "Recursive CTEs",
    "lesson-order": 18,
    "database-tables": [
        {
            "name": "Countries",
            "priority": 1
        }
    ],
    "exercise-tasks": [
        {
            "task-id": 18.1,
            "description": "Create a recursive CTE that selects all country names with a starting level value of 1.",
            "correct-query": "WITH RECURSIVE CountryLevels AS (\n  SELECT Name,\n  1 AS level\n  FROM Countries\n)\n\nSELECT * FROM CountryLevels;",
            "verify-query": "WITH RECURSIVE CountryLevels AS (SELECT Name, 1 AS level FROM Countries) SELECT * FROM CountryLevels;",
            "order-sensitive": false,
            "exercise-order": 1,
            "initial-query": "SELECT * FROM Countries;",
            "large-query": false,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": true
        },
        {
            "task-id": 18.2,
            "description": "Extend the recursive CTE so it adds a second level for each country.",
            "correct-query": "WITH RECURSIVE CountryLevels AS (\n  SELECT Name, 1 AS level\n  FROM Countries\n  \n  UNION ALL\n  \n  SELECT Name, level + 1\n  FROM CountryLevels\n  WHERE level < 2\n)\n\nSELECT * FROM CountryLevels;",
            "verify-query": "WITH RECURSIVE CountryLevels AS (SELECT Name, 1 AS level FROM Countries UNION ALL SELECT Name, level + 1 FROM CountryLevels WHERE level < 2) SELECT * FROM CountryLevels;",
            "order-sensitive": false,
            "exercise-order": 2,
            "initial-query": "SELECT Name FROM Countries;",
            "large-query": true,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": true
        },
        {
            "task-id": 18.3,
            "description": "Modify the recursive CTE so it includes population and stops after level 3.",
            "correct-query": "WITH RECURSIVE CountryLevels AS (\n  SELECT Name, Population, 1 AS level\n  FROM Countries\n\n  UNION ALL\n\n  SELECT Name, Population, level + 1 FROM CountryLevels\n  WHERE level < 3\n)\n\nSELECT * FROM CountryLevels;",
            "verify-query": "WITH RECURSIVE CountryLevels AS (SELECT Name, Population, 1 AS level FROM Countries UNION ALL SELECT Name, Population, level + 1 FROM CountryLevels WHERE level < 3) SELECT * FROM CountryLevels;",
            "order-sensitive": false,
            "exercise-order": 3,
            "initial-query": "SELECT * FROM Countries;",
            "large-query": true,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": true
        },
        {
            "task-id": 18.4,
            "description": "Return only the rows from the recursive CTE where the level value is 3.",
            "correct-query": "WITH RECURSIVE CountryLevels AS (\n  SELECT Name, Population, 1 AS level FROM Countries\n\n  UNION ALL\n\n  SELECT Name, Population, level + 1 FROM CountryLevels\n  WHERE level < 3\n)\n\nSELECT Name, Population FROM CountryLevels\nWHERE level = 3;",
            "verify-query": "WITH RECURSIVE CountryLevels AS (SELECT Name, Population, 1 AS level FROM Countries UNION ALL SELECT Name, Population, level + 1 FROM CountryLevels WHERE level < 3) SELECT Name, Population FROM CountryLevels WHERE level = 3;",
            "order-sensitive": false,
            "exercise-order": 4,
            "initial-query": "SELECT * FROM Countries;",
            "large-query": true,
            "allow-dml": false,
            "create-tables": false,
            "preview-allowed": true,
            "chatgpt-prompt": true
        }
    ]
}